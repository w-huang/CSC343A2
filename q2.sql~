SET search_path TO artistdb;
CREATE VIEW Solo AS(
SELECT album_id, sales, Album.artist_id, Artist.name
FROM Album, Artist
WHERE Album.artist_id = Artist.artist_id and album_id NOT IN (SELECT DISTINCT album_id
FROM BelongsToAlbum, Collaboration
WHERE BelongsToAlbum.song_id = Collaboration.song_id)
);

CREATE VIEW Collab AS(
(SELECT album_id, sales, Album.artist_id, Artist.name
FROM Album, Artist
WHERE Album.artist_id = Artist.artist_id)
EXCEPT
(SELECT * FROM Solo)
);

SELECT Solo.name as artists, avg(Collab.sales) as avg_collab_sales
FROM Solo, Collab
WHERE Solo.artist_id = Collab.artist_id
GROUP BY Solo.artist_id
HAVING avg(Collab.sales) > all(Solo.sales);

